<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:t="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AdminLTE 2 | Starter</title>
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!--<meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">-->

    <!-- Font Awesome -->
    <link th:href="@{/webjars/font-awesome/4.7.0/css/font-awesome.min.css}" rel="stylesheet">
    <!-- Ionicons -->
    <link th:href="@{/webjars/ionicons/2.0.1/css/ionicons.min.css}" rel="stylesheet">
    <!-- Bootstrap 3.3.7 -->
    <link rel="stylesheet" th:href="@{/webjars/bootstrap/3.3.7/css/bootstrap.min.css}">
    <!-- Select2 -->
    <link rel="stylesheet" th:href="@{/webjars/select2/4.0.5/css/select2.min.css}">
    <link rel="stylesheet" th:href="@{/webjars/select2-bootstrap-theme/0.1.0-beta.10/dist/select2-bootstrap.min.css}">

    <link rel="stylesheet" th:href="@{/webjars/bootstrap-table/1.12.1/dist/bootstrap-table.min.css}">
    <link rel="stylesheet" th:href="@{/webjars/jquery-treegrid/0.3.0/css/jquery.treegrid.css}">
    <!-- toastr 2.1.3 -->
    <link rel="stylesheet" th:href="@{/webjars/toastr/2.1.3/toastr.min.css}">
    <link rel="stylesheet" th:href="@{/webjars/bootstrap-sweetalert/1.0.1/dist/sweetalert.css}">
    <link rel="stylesheet" th:href="@{/css/user-manage.css}">
    <!--[if lt IE 9]>
    <script src="/webjars/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
    <script src="/webjars/respond/1.4.2/dest/respond.min.js"></script>
    <![endif]-->
    <link rel="stylesheet" th:href="@{/css/common.css}">
</head>
<body>
<div>
    <!-- Content Header (Page header) -->
    <section  class="content-header">
        <small>侧边栏菜单管理</small>
    </section>

    <!-- Main content -->
    <section class="content container-fluid">
        <!-- http://issues.wenzhixin.net.cn/bootstrap-table/options/custom-toolbar.html -->
        <form id="form-search" name="form-search" class="form-inline" role="form">
            <!--<div class="form-group">
                <span>Offset: </span>
                <input name="offset" class="form-control w70" type="number" value="0">
            </div>
            <div class="form-group">
                <span>Limit: </span>
                <input name="limit" class="form-control w70" type="number" value="5">
            </div>-->
            <div class="form-group">
                <span>菜单名称: </span>
                <input class="form-control" type="text" id="search_name" name="name" placeholder="菜单名称">
            </div>
            <div class="form-group">
                <span>权限: </span>
                <t:dict class="select2 form-control w70" id="search_authority" name="authority" dict-name="role_type" allow-empty="true" data-live-search="true"></t:dict>
            </div>
            <button id="btn_search" type="button" class="btn btn-default" onclick="search()"><i class="fa fa-search" aria-hidden="true"></i> 查询</button>
            <button id="btn_reset" type="button" class="btn btn-default" onclick="searchReset()"><i class="fa fa-refresh" aria-hidden="true"></i> 重置</button>
        </form>
        <div th:replace="components/toolbar :: toolbar"></div>
        <table id="table"></table>

        <!-- 模态框（Modal） -->
        <div class="modal fade" id="addModal" role="dialog" aria-labelledby="addModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
                        <h4 class="modal-title" id="addModalLabel">
                            添加
                        </h4>
                    </div>
                    <form class="form-horizontal" method="post" role="form" id="form-add" name="form-add">
                        <div class="modal-body">
                            <div class="form-group">
                                <label for="add_menu_type" class="col-sm-3 control-label">菜单类型</label>
                                <div class="col-sm-6">
                                    <t:dict class="form-control select2" id="add_menu_type" name="menuType" dict-name="menu_type" style="width:100%"></t:dict>
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                            <div class="form-group" id="parent_menu">
                                <label for="add_menu_group_id" class="col-sm-3 control-label">父菜单</label>
                                <div class="col-sm-6">
                                    <t:select id="add_menu_group_id" name="pid" order="desc" query="t_side_menu,name,id,pid is null" class="form-control select2" data-live-search="true" style="width:100%"></t:select>
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                            <div class="form-group">
                                <label for="add_name" class="col-sm-3 control-label">菜单名称</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="add_name" name="name" placeholder="菜单名称">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">链接</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" name="url" placeholder="链接">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                            <div class="form-group">
                                <label for="add_authority" class="col-sm-3 control-label">菜单权限</label>
                                <!--<div class="col-sm-9">
                                    <input type="text" class="form-control" id="menuGroupAuthority" name="menuGroupAuthority" placeholder="菜单组权限">
                                </div>-->
                                <div class="col-sm-6">
                                    <t:dict class="form-control select2" id="add_authority" name="authority" dict-name="role_type" multiple="multiple" style="width:100%"></t:dict>
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                            <div class="form-group">
                                <label for="add_icon" class="col-sm-3 control-label">菜单图标</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="add_icon" name="icon" placeholder="菜单图标">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                            <div class="form-group">
                                <label for="add_orderNum" class="col-sm-3 control-label">排序</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" id="add_orderNum" name="orderNum" placeholder="排序">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                            </button>
                            <button type="button" class="btn btn-primary" onclick="add()">
                                提交更改
                            </button>
                        </div>
                    </form>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>

        <!-- 模态框（Modal） -->
        <div class="modal fade" id="editModal" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                            &times;
                        </button>
                        <h4 class="modal-title" id="editModalLabel">
                            编辑
                        </h4>
                    </div>
                    <form class="form-horizontal" method="post" role="form" id="form-edit" name="form-edit">
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="col-sm-3 control-label">菜单id</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" name="id" placeholder="菜单id" readonly="readonly">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">菜单名称</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" name="name" placeholder="菜单名称">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">链接</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" name="url" placeholder="链接">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">菜单权限</label>
                                <!--<div class="col-sm-9">
                                    <input type="text" class="form-control" id="menuGroupAuthority" name="menuGroupAuthority" placeholder="菜单权限">
                                </div>-->
                                <div class="col-sm-6">
                                    <!--<t:dict class="form-control select2" id="menuGroupAuthority" name="menuGroupAuthority" dict-name="role_type" data-live-search="true" style="width:100%"></t:dict>-->
                                    <t:dict class="form-control select2" name="authority" dict-name="role_type" multiple="multiple" style="width:100%"></t:dict>
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">菜单图标</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" name="icon" placeholder="菜单图标">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                            <div class="form-group">
                                <label class="col-sm-3 control-label">排序</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control" name="orderNum" placeholder="排序">
                                </div>
                                <div class="col-sm-3"></div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭
                            </button>
                            <button type="button" class="btn btn-primary" onclick="update()">
                                提交更改
                            </button>
                        </div>
                    </form>
                </div><!-- /.modal-content -->
            </div><!-- /.modal -->
        </div>
    </section>
    <!-- /.content -->
</div>
<!-- ./wrapper -->
<!-- jQuery 3 -->
<script th:src="@{/webjars/jquery/3.3.1/dist/jquery.min.js}"></script>
<!-- Bootstrap 3.3.7 -->
<script th:src="@{/webjars/bootstrap/3.3.7/js/bootstrap.min.js}"></script>
<!-- Select2 -->
<script th:src="@{/webjars/select2/4.0.5/js/select2.full.min.js}"></script>
<script th:src="@{/webjars/bootstrap-sweetalert/1.0.1/dist/sweetalert.min.js}"></script>
<!--<script th:src="@{/webjars/sweetalert2/7.26.29/dist/sweetalert2.all.min.js}"></script>-->
<!-- Bootstrap Table 1.12.1 -->
<script th:src="@{/webjars/bootstrap-table/1.12.1/dist/bootstrap-table.min.js}"></script>
<script th:src="@{/webjars/bootstrap-table/1.12.1/dist/locale/bootstrap-table-zh-CN.min.js}"></script>
<script th:src="@{/webjars/bootstrap-table/1.12.1/dist/extensions/mobile/bootstrap-table-mobile.min.js}"></script>
<script th:src="@{/webjars/bootstrap-table/1.12.1/dist/extensions/treegrid/bootstrap-table-treegrid.min.js}"></script>
<script th:src="@{/webjars/bootstrap-table/1.12.1/dist/extensions/resizable/bootstrap-table-resizable.js}"></script>

<!-- jquery treegrid 0.3.0 -->
<script th:src="@{/plug-in/colResizable.jquery.plugin/colResizable-1.5.source.js}"></script>
<script th:src="@{/webjars/jquery-treegrid/0.3.0/js/jquery.treegrid.min.js}"></script>
<script th:src="@{/webjars/jquery-treegrid/0.3.0/js/jquery.treegrid.bootstrap3.js}"></script>

<!-- tableExport -->
<script th:src="@{/webjars/bootstrap-table/1.12.1/dist/extensions/export/bootstrap-table-export.min.js}"></script>
<script th:src="@{/plug-in/tableExport.jquery.plugin/libs/FileSaver/FileSaver.min.js}"></script>
<script th:src="@{/plug-in/tableExport.jquery.plugin/libs/js-xlsx/xlsx.core.min.js}"></script>
<script th:src="@{/plug-in/tableExport.jquery.plugin/libs/jsPDF/jspdf.min.js}"></script>
<script th:src="@{/plug-in/tableExport.jquery.plugin/libs/jsPDF-AutoTable/jspdf.plugin.autotable.js}"></script>
<script th:src="@{/plug-in/tableExport.jquery.plugin/libs/pdfmake/pdfmake.min.js}"></script>
<script th:src="@{/plug-in/tableExport.jquery.plugin/libs/pdfmake/vfs_fonts.js}"></script>
<script th:src="@{/plug-in/tableExport.jquery.plugin/libs/html2canvas/html2canvas.min.js}"></script>
<script th:src="@{/plug-in/tableExport.jquery.plugin/tableExport.js}"></script>

<script th:src="@{/webjars/jquery-cookie/1.4.1-1/jquery.cookie.js}"></script>

<!-- toastr 2.1.3 -->
<script th:src="@{/webjars/toastr/2.1.3/toastr.min.js}"></script>

<!-- jquery validate 1.8.0 -->
<script th:src="@{/webjars/jquery-validation/1.18.0/dist/jquery.validate.min.js}"></script>
<script th:src="@{/webjars/jquery-validation/1.18.0/src/localization/messages_zh.js}"></script>

<script th:src="@{/js/util.js}"></script>
<script th:src="@{/js/table.js}"></script>
<script th:src="@{/js/common.js}"></script>
<script>
    var $table = $('#table');
    $(function() {
        /*$table.bootstrapTable({
            url: 'sideMenus',
            // height: $(window).height(),
            pagination: true,
            paginationPreText: '上一页',
            paginationNextText: '下一页',
            sidePagination: 'server',
            pageNumber: 1,
            pageSize: 5,
            pageList: [10, 25, 50, 100],
            showPaginationSwitch: true,
            resizable: true,
            idField: 'id',
            columns: [
                {
                    field: 'state',
                    checkbox: true
                },
                {
                    field: 'name',
                    title: '菜单名称',
                    align: 'left',
                    formatter: function(value, row, index, field) {
                        if(row.pid){
                            return '<i class="fa fa-file-o" aria-hidden="true"></i> ' + value;
                        }else{
                            return value;
                        }
                    }
                },
                {
                    field: 'authorityName',
                    title: '菜单组权限',
                    align: 'center',
                },
                {
                    field: 'icon',
                    title: '菜单组图标',
                    align: 'center',
                    formatter: function(value, row, index, field){
                        return '<i class="' + value + '" aria-hidden="true"></i>';
                    }
                },
                {
                    field: 'orderNum',
                    title: '排序',
                    align: 'center',
                }
            ],
            // bootstrap-table-tree-column.js 插件配置
            // treeShowField: 'name',
            // parentIdField: 'pid'
            // bootstrap-table-tree-column.js 插件配置

            // bootstrap-table-treegrid.js 插件配置
            treeShowField: 'name',
            parentIdField: 'pid',
            onLoadSuccess: function(data) {
                console.log('load');
                // jquery.treegrid.js
                $table.treegrid({
                    initialState: 'collapsed',
                    treeColumn: 1,
                    expanderExpandedClass: 'fa fa-folder-open-o',
                    expanderCollapsedClass: 'fa fa-folder-o',
                    onChange: function() {
                        $table.bootstrapTable('resetWidth');
                    }
                });
            }
            // bootstrap-table-treetreegrid.js 插件配置
        });*/
        initTableTreegrid('table', {
            url: 'sideMenus',
            idField: 'id',
            // bootstrap-table-tree-column.js 插件配置
            // treeShowField: 'name',
            // parentIdField: 'pid'
            // bootstrap-table-tree-column.js 插件配置

            // bootstrap-table-treegrid.js 插件配置
            treeShowField: 'name',
            parentIdField: 'pid',
            columns: [
                {
                    field: 'state',
                    checkbox: true
                },
                {
                    field: 'name',
                    title: '菜单名称',
                    align: 'left',
                    formatter: function(value, row, index, field){
                        return childMenuFormatter(value, row, index, field);
                    }
                },
                {
                    field: 'createDate',
                    title: '创建时间',
                    align: 'center',
                    formatter: function formatter(value, row, index, field) {
                        if(!value){
                            return value;
                        }
                        return new Date(value).format("yyyy-MM-dd hh:mm:ss");
                    }
                },
                {
                    field: 'url',
                    title: '链接',
                    align: 'center',
                    formatter: function(value, row, index, field){
                        if (value){
                            return '<a href="' + value + '" target="_blank">' + value + '</a>';
                        }else{
                            return value;
                        }
                    }
                },
                {
                    field: 'authority',
                    title: '菜单组权限',
                    align: 'center',
                },
                {
                    field: 'icon',
                    title: '菜单组图标',
                    align: 'center',
                    formatter: function(value, row, index, field){
                        return '<i class="' + value + '" aria-hidden="true"></i>';
                    }
                },
                {
                    field: 'orderNum',
                    title: '排序',
                    align: 'center',
                }
            ],
            queryParams: function (params) {
                params['authority'] = $('#search_authority').val() ; //单选
                params['name'] = $('#search_name').val();
                return params;
            },
            ignoreColumn: []
        });
    });

    function search() {
        console.log('search');
        $table.bootstrapTable('refresh', {silent: false});
    }

    function searchReset() {
        console.log('searchReset');
        document.getElementById("form-search").reset();
        $('#form-search .select2').val(null).trigger('change');
    }

    // 格式化类型
    function typeFormatter(value, row, index) {
        if (value === 'menu') {
            return '菜单';
        }
        if (value === 'button') {
            return '按钮';
        }
        if (value === 'api') {
            return '接口';
        }
        return '-';
    }

    // 格式化状态
    function statusFormatter(value, row, index) {
        if (value === 1) {
            return '<span class="label label-success">正常</span>';
        } else {
            return '<span class="label label-default">锁定</span>';
        }
    }

    /*initTable('table', {
        detailView: true,
        url: 'sideMenuGroups/data',
        columns: [{
            field: 'state',
            checkbox: true
        }, {
            field: 'id',
            title: 'id',
            align: 'center'
        },
        {
            field: 'createBy',
            title: '创建人id',
            align: 'center',
        },
        {
            field: 'createDate',
            title: '创建时间',
            align: 'center',
            formatter: function formatter(value, row, index, field) {
                if(!value){
                    return value;
                }
                return new Date(value).format("yyyy-MM-dd hh:mm:ss");
            }
        },
        {
            field: 'updateBy',
            title: '更新人id',
            align: 'center',
        },
        {
            field: 'updateDate',
            title: '更新时间',
            align: 'center',
            formatter: function formatter(value, row, index, field) {
                if(!value){
                    return value;
                }
                return new Date(value).format("yyyy-MM-dd hh:mm:ss");
            }
        },
        {
            field: 'menuGroupName',
            title: '菜单组名称',
            align: 'center',
        },
        {
            field: 'menuGroupAuthorityName',
            title: '菜单组权限',
            align: 'center',
        },
        {
            field: 'menuGroupIcon',
            title: '菜单组图标',
            align: 'center',
            formatter: function formatter(value, row, index, field){
                return '<i class="' + value + '" aria-hidden="true"></i>';
            }
        },
        {
            field: 'orderNum',
            title: '排序',
            align: 'center',
        },{
            field: 'id',
            title: '操作',
            align: 'center',
            formatter: function formatter(value, row, index, field) {
                return '<button type="button" class="btn btn-primary" onclick="updateObject(\'' + value + '\',' + index + ')"><i class="fa fa-pencil" aria-hidden="true"></i> 编辑</button> <button type="button" class="btn btn-danger" onclick="deleteObject(\'' + value + '\')"><i class="fa fa-trash-o" aria-hidden="true"></i> 删除</button>';
            }
        }
    ],
        ignoreColumn: []
    });*/

    function update(){
        let flag = $("#form-edit").valid();
        if(!flag){
            //没有通过验证
            return;
        }
        /*var formData = new FormData(document.getElementById('form-edit'));
        formData.append('_method', 'PATCH'); */
        let requestData = $('#form-edit').serializeArray();
        console.log(requestData);
        console.log(typeof requestData);
        let sideMenuGroup = {};
        for(let i = 0; i < requestData.length; i++){
            //如果存在相同的属性，则该属性值是数组类型。
            if(sideMenuGroup[requestData[i].name]){
                /*if(checkArray(sideMenuGroup[requestData[i].name])){
                    sideMenuGroup[requestData[i].name].push(requestData[i].value);
                }else{
                    var arr = [];
                    arr.push(sideMenuGroup[requestData[i].name]);
                    arr.push(requestData[i].value);
                    sideMenuGroup[requestData[i].name] = arr;
                }*/
                sideMenuGroup[requestData[i].name] += ',' + requestData[i].value;
            }else{
                sideMenuGroup[requestData[i].name] = requestData[i].value;
            }
        }
        //sideMenuGroup['_method'] = 'PATCH';
        console.log(sideMenuGroup);
        $.ajax({
            url: '/sideMenus',
            type: 'PATCH',
            data: JSON.stringify(sideMenuGroup),
            contentType: "application/json;charset=UTF-8",
            success:function (data) {
                console.log(data);
                $('#editModal').modal('hide');
                refreshTable('table');
                toastr["success"]("操作成功！", "提示信息");
            }
        });
        return false;
    }

    function addObject() {
        //清空表单
        document.getElementById("form-add").reset();
        $('#form-add .select2').val(null).trigger('change');
        $('#parent_menu').hide();
        $("#addModal").modal('show');  //手动开启
    }

    function add() {
        let flag = $("#form-add").valid();
        if(!flag){
            //没有通过验证
            return;
        }
        let requestData = $('#form-add').serializeArray();
        console.log(requestData);
        console.log(typeof requestData);
        let sideMenuGroup = {};
        let i;
        for(i = 0; i < requestData.length; i++){
            //如果存在相同的属性，则该属性值是数组类型。
            if(sideMenuGroup[requestData[i].name]){
                /*if(checkArray(sideMenuGroup[requestData[i].name])){
                    sideMenuGroup[requestData[i].name].push(requestData[i].value);
                }else{
                    var arr = [];
                    arr.push(sideMenuGroup[requestData[i].name]);
                    arr.push(requestData[i].value);
                    sideMenuGroup[requestData[i].name] = arr;
                }*/
                sideMenuGroup[requestData[i].name] += ',' + requestData[i].value;
            }else{
                sideMenuGroup[requestData[i].name] = requestData[i].value;
            }
        }
        console.log(sideMenuGroup);
        $.ajax({
            url: '/sideMenus',
            type: 'post',
            data: JSON.stringify(sideMenuGroup),
            contentType: "application/json;charset=UTF-8",
            success:function (data) {
                console.log(data);
                $('#addModal').modal('hide');
                refreshTable('table');
                toastr["success"]("操作成功！", "提示信息");
            }
        });
        return false;
    }

    function updateObject(){
        let $select = $('#table').bootstrapTable('getSelections');
        if ($select.length <= 0 || $select.length > 1) {
            swal({
                title: '提示信息',
                text: '请选择一条数据！',
                confirmButtonText: "确定"
            });
        }
        else{
            let data = $select[0];
            $('#editModal input[name="id"]').val(data.id);
            $('#editModal input[name="name"]').val(data.name);
            $('#editModal input[name="url"]').val(data.url);
            $('#editModal select[name="authority"]').val(null).trigger('change');

            if(data.authority){
                console.log(data.authority);
                $('#editModal select[name="authority"]').val(data.authority.split(',')).trigger('change');
            }
            $('#editModal input[name="icon"]').val(data.icon);
            $('#editModal input[name="orderNum"]').val(data.orderNum);
            $("#editModal").modal('show');  //手动开启
        }
        /*var dataList = $('#table').bootstrapTable('getData');
        var data = dataList[index];
        console.log(data.menuGroupName);*/
    }

    function delObjects(){
        let arr= $('#table').bootstrapTable('getSelections');
        if(arr.length <= 0){
            swal({
                title: '提示信息',
                text: '请至少选择一条数据！',
                confirmButtonText: "确定"
            });
        }
        let ids = [];
        let i;
        for(i = 0; i < arr.length; i++){
            ids.push(arr[i].id);
        }
        console.log(ids.join(','));
        $.ajax({
            url:'sideMenus/ids/' + ids.join(','),
            type:'POST',
            data:{_method:"DELETE"},
            success:function(data){
                console.log(data);
                toastr["success"]("操作成功！", "提示信息");
                refreshTable('table');
            }
        });
    }

    $(function(){
        //Initialize Select2 Elements
        $('.select2').select2({
            theme: "bootstrap"
        });
        //解决select2校验不实时的问题
        $(".select2").on("select2:select",function(){
            $(this).valid();
        });

        $('#add_menu_type').change(function () {
            var menuType=$(this).children('option:selected').val();//这就是selected的值
            console.log('menuType=' + menuType);
            if(2 == menuType){
                //$('#parent_menu').css('visibility', 'visible');
                $('#parent_menu').fadeIn();
            }else if(1 == menuType){
                $('#parent_menu').fadeOut();
            }
        });

        $('#form-add').validate({
            ignore: "",//对隐藏的属性进行校验，解决无法校验select
            rules: {
                menuType: {
                    required: true
                },
                name: {
                    required: true
                },
                authority: {
                    required: true
                }
            },
            messages: {

            },
            errorPlacement: function(error, element) {
                //错误信息位置设置方法
                //这里的element是录入数据的对象
                error.appendTo(element.parent().parent().children('div:last-child'));
            },
            errorClass: "error"
        });

        $('#form-edit').validate({
            ignore: "",//对隐藏的属性进行校验，解决无法校验select
            rules: {
                id: {
                    required: true
                },
                menuType: {
                    required: true
                },
                name: {
                    required: true
                },
                authority: {
                    required: true
                }
            },
            messages: {

            },
            errorPlacement: function(error, element) {
                //错误信息位置设置方法
                //这里的element是录入数据的对象
                error.appendTo(element.parent().parent().children('div:last-child'));
            },
            errorClass: "error"
        });
    });
</script>
</body>
</html>